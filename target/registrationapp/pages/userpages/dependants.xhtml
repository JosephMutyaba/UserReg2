<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Display All Users</title>
    <h:outputStylesheet name="css/newui/dependants.css"/>
</h:head>

<h:body>
    <div class="container">
        <div class="sidebar">
            <ui:include src="sidebar.xhtml"/>
        </div>
        <div class="main-content">
            <div class="dependants-management">
                <h2 class="dependants-header">Dependants</h2>
                <div class="summary-cards">
                    <div class="card">
                        <div class="icon-wrapper">
                            <i class="fa fa-mars"/>
                        </div>
                        <div class="content">
                            <h4>Male Dependants</h4>
                            <p>#{userDashboardStats.maleUserCount}</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="icon-wrapper">
                            <i class="fa fa-venus"/>
                        </div>
                        <div class="content">
                            <h4>Female Dependants</h4>
                            <p>#{userDashboardStats.femaleUserCount}</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="icon-wrapper">
                            <i class="fa fa-retweet"/>
                        </div>
                        <div class="content">
                            <h4>Dependency ratio</h4>
                            <p>#{userDashboardStats.maleFemaleRatio}</p>
                        </div>
                    </div>
                </div>



                <div>
                    <h:form id="searchDependantsForm" styleClass="search-form">
                        <div class="search-bar">
                            <h:selectOneMenu value="#{userView.selectedGender}">
                                <f:selectItem itemLabel="Select Gender" itemValue="" />
                                <f:selectItem itemLabel="Male" itemValue="Male" />
                                <f:selectItem itemLabel="Female" itemValue="Female" />
                                <p:ajax event="change" update="dependantsForm" listener="#{userView.searchingDependants}" />
                            </h:selectOneMenu>

                            <p:inputText placeholder="username" id="searchUsername" value="#{userView.searchDependantUsername}">
                                <p:ajax event="keyup" update="dependantsForm" listener="#{userView.searchingDependants}" />
                            </p:inputText>

                            <p:inputText placeholder="firstname" id="searchFirstName" value="#{userView.searchDependantFirstName}">
                                <p:ajax event="keyup" update="dependantsForm" listener="#{userView.searchingDependants}" />
                            </p:inputText>

                            <p:inputText placeholder="lastname" id="searchLastName" value="#{userView.searchDependantLastName}">
                                <p:ajax event="keyup" update="dependantsForm" listener="#{userView.searchingDependants}" />
                            </p:inputText>

                        </div>
                    </h:form>
                </div>





                <div>
                    <h:form id="displayForm" styleClass="top-section">

                        <p:commandLink oncomplete="PF('addDependantDialog').show()" styleClass="link">
                            <i class="fa fa-plus" style="color: white"/> Add Dependant
                        </p:commandLink>
                        <p:commandLink styleClass="link_del" action="#{deleteAllDependantsOfUser.selectUserId(userView.user.id)}" oncomplete="PF('deleteAllDependantsDialog').show()" process="@this">
                            <i class="fa fa-trash" style="color: white"/> Delete All Dependants
                        </p:commandLink>

                    </h:form>
                </div>

                <div class="dependants-table">
                    <h:form id="dependantsForm">
                        <p:dataTable id="dependants-table" value="#{userView.dependants}" var="dependant" paginator="true" rows="5" styleClass="data-table">
                            <p:column headerText="No">
                                <h:outputText value="#{userView.dependants.indexOf(dependant) + 1}"/>
                            </p:column>
                            <p:column headerText="First Name">
                                <h:outputText value="#{dependant.firstname}"/>
                            </p:column>
                            <p:column headerText="Last Name">
                                <h:outputText value="#{dependant.lastname}"/>
                            </p:column>

                            <p:column headerText="Date of Birth">
                                <h:outputText value="#{dependant.dateOfBirth}">
                                    <f:convertDateTime pattern="yyyy-MM-dd" />
                                </h:outputText>
                            </p:column>

                            <p:column headerText="Gender">
                                <h:outputText value="#{dependant.gender}"/>
                            </p:column>
                            <p:column headerText="User">
                                <h:outputText value="#{dependant.user}"/>
                            </p:column>



                            <p:column headerText="Actions">
                                <p:commandLink actionListener="#{updateDependant.selectDependantUser(dependant.id)}" update="updateForm" oncomplete="PF('updateDependantDialog').show()" styleClass="action-link" process="@this">
                                    <i class="fa fa-edit" style="color:blue"/>
                                </p:commandLink>

                                <p:commandLink styleClass="action-link" action="#{deleteDependantOfUser.selectedId(dependant.id)}" oncomplete="PF('deleteDialog').show()" process="@this">
                                    <i class="fa fa-trash" style="color: red; margin-left: 15px"/>
                                    <f:setPropertyActionListener target="#{deleteDependantOfUser.dependant_id}" value="#{dependant.id}" />
                                </p:commandLink>
                            </p:column>

                        </p:dataTable>


                    </h:form>

                    <!-- Delete Confirmation Dialog -->
                    <p:dialog header="Confirm Deletion" widgetVar="deleteDialog" modal="true" width="300">
                        <h:form>
                            <h:panelGrid columns="2">
                                <h:outputText value="Are you sure you want to delete?" />
                                <br/>
                                <p:commandButton value="Yes" action="#{deleteDependantOfUser.deleteDependant}" oncomplete="PF('deleteDialog').hide(); updateDependantTable();" />
                                <p:commandButton value="Cancel" onclick="PF('deleteDialog').hide(); return false;" />
                            </h:panelGrid>
                        </h:form>
                    </p:dialog>

                    <!-- Delete All dependants Confirmation Dialog -->
                    <p:dialog header="Confirm Deletion" widgetVar="deleteAllDependantsDialog" modal="true" width="300">
                        <h:form>
                            <h:panelGrid columns="2">
                                <h:outputText value="Delete All Dependants?" />
                                <br/>
                                <p:commandButton value="Yes" action="#{deleteAllDependantsOfUser.deleteAllDependants}" oncomplete="PF('deleteAllDependantsDialog').hide(); updateDependantTable();" />
                                <p:commandButton value="Cancel" onclick="PF('deleteAllDependantsDialog').hide(); return false;" />
                            </h:panelGrid>
                        </h:form>
                    </p:dialog>




<!--                     Add New definition -->

                    <p:dialog header="New Dependant" widgetVar="addDependantDialog" modal="true" resizable="false" width="500" height="400">
                        <h:form id="registerForm" styleClass="form">
                            <h:panelGrid columns="3" styleClass="borderless-grid">

                                <h:outputLabel for="usern_ame" value="Username:" styleClass="label"/>
                                <p:inputText id="usern_ame" value="#{addDependantView.username}" required="true" styleClass="input">
                                    <f:validateLength minimum="4" maximum="20"/>
                                </p:inputText>
                                <h:message for="usern_ame" styleClass="error"/>

                                <h:outputLabel for="firs_tname" value="First Name:" styleClass="label"/>
                                <p:inputText id="firs_tname" value="#{addDependantView.firstname}" required="true" styleClass="input">
                                    <f:validateLength minimum="2" maximum="30"/>
                                </p:inputText>
                                <h:message for="firs_tname" styleClass="error"/>

                                <h:outputLabel for="last_name" value="Last Name:" styleClass="label"/>
                                <p:inputText id="last_name" value="#{addDependantView.lastname}" required="true" styleClass="input">
                                    <f:validateLength minimum="2" maximum="30"/>
                                </p:inputText>
                                <h:message for="last_name" styleClass="error"/>

                                <h:outputLabel for="do_b" value="Date of Birth:" styleClass="label"/>
                                <p:calendar id="do_b" value="#{addDependantView.dateOfBirth}" required="true" showButtonPanel="true"
                                            navigator="true" maxdate="#{addDependantView.today}" yearRange="c-100:c"
                                            pattern="yyyy-MM-dd" styleClass="input"/>
                                <h:message for="do_b" styleClass="error"/>

                                <h:outputLabel for="gen_der" value="Gender:" styleClass="label"/>
                                <p:selectOneMenu id="gen_der" value="#{addDependantView.gender}" required="true" styleClass="selectMenu">
                                    <f:selectItem itemLabel="Select Gender" itemValue=""/>
                                    <f:selectItem itemLabel="Male" itemValue="Male"/>
                                    <f:selectItem itemLabel="Female" itemValue="Female"/>
                                </p:selectOneMenu>
                                <h:message for="gen_der" styleClass="error"/>

                            </h:panelGrid>
                            <p:commandButton icon="pi pi-plus" value="Add dependant" action="#{addDependantView.addDependantUser(userView.user)}" styleClass="button" update="registerForm globalMessages" oncomplete="if (!args.validationFailed) PF('addDependantDialog').hide(); updateDependantTable()" />

                            <h:messages globalOnly="true" styleClass="messages" id="globalMessages"/>
                        </h:form>
                    </p:dialog>







                    <!-- Update Dependant Dialog -->
                    <p:dialog header="Update Dependant" widgetVar="updateDependantDialog" modal="true" width="400px">
                        <h:form id="updateForm">
                            <h:panelGrid columns="2" cellpadding="5">
                                <h:outputLabel for="username" value="Username:"/>
                                <p:inputText id="username" value="#{updateDependant.username}" required="true"/>

                                <h:outputLabel for="firstname" value="First Name:"/>
                                <p:inputText id="firstname" value="#{updateDependant.firstname}" required="true"/>

                                <h:outputLabel for="lastname" value="Last Name:"/>
                                <p:inputText id="lastname" value="#{updateDependant.lastname}" required="true"/>

                                <h:outputLabel for="dateOfBirth" value="Date of Birth:"/>
                                <p:calendar id="dateOfBirth" value="#{updateDependant.dateOfBirth}" pattern="yyyy-MM-dd" required="true" navigator="true" yearRange="c-100:c"/>

                                <h:outputLabel for="gender" value="Gender:"/>
                                <h:selectOneMenu id="gender" value="#{updateDependant.gender}" required="true">
                                    <f:selectItem itemLabel="Select Gender" itemValue="" />
                                    <f:selectItem itemLabel="Male" itemValue="Male" />
                                    <f:selectItem itemLabel="Female" itemValue="Female" />
                                </h:selectOneMenu>
                            </h:panelGrid>
                            <p:commandButton value="Update" action="#{updateDependant.updateADependantUser}" update="dependantsForm" oncomplete="PF('updateDependantDialog').hide()"/>

                        </h:form>
                    </p:dialog>
                    <!-- Remote Command to update the user table -->
                    <p:remoteCommand name="updateDependantTable" update="dependantsForm" />



                </div>
            </div>

        </div>
    </div>
</h:body>
</html>
