<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
   <title>Get User by Username</title>
   <h:outputStylesheet name="css/getUser.css"/>
</h:head>
<h:body>
   <h:form id="getUserForm" styleClass="form">
      <h:commandLink value="Back home" action="/index.xhtml" styleClass="link"/>
   </h:form>
   <h1 class="header">Get User by Username</h1>
   <h:form id="userDetailsForm" styleClass="form">
      <h:outputLabel for="username" value="Enter Username:" styleClass="label"/>
      <h:inputText id="username" value="#{userView.username}" styleClass="input"/>
      <h:commandButton value="Fetch User" action="#{userView.getUserOfUsername}" update=":userDetailsForm:userDetailsPanel" styleClass="button"/>
      <br/>
      <h:messages globalOnly="true" styleClass="messages"/>

      <h:panelGrid id="userDetailsPanel" columns="2" rendered="#{userView.user.username ne null}" styleClass="panelGrid">
         <h:outputLabel value="Username:" styleClass="label"/>
         <h:outputText value="#{userView.user.username}" styleClass="outputText"/>
         <h:outputLabel value="First Name:" styleClass="label"/>
         <h:outputText value="#{userView.user.firstname}" styleClass="outputText"/>
         <h:outputLabel value="Last Name:" styleClass="label"/>
         <h:outputText value="#{userView.user.lastname}" styleClass="outputText"/>
         <h:outputLabel value="Date of Birth:" styleClass="label"/>
         <h:outputText value="#{userView.user.dateOfBirth}" styleClass="outputText"/>

         <h:outputLabel value="Dependants:" style="margin-top:20px;" styleClass="label"/>
         <h:outputText value=""/>

         <h:commandButton value="Delete All Dependants" action="#{userView.deleteAllDependants}" style="margin-top:10px;" update=":userDetailsForm:dependantsTable" styleClass="button"/>
         <p:commandButton value="Add Dependant" oncomplete="PF('addDependantDialog').show()" style="margin-top:10px;" styleClass="button"/>
         <h:outputLabel value="Search:" styleClass="label"/>
         <h:inputText id="searchValue" value="#{userView.searchValue}" styleClass="input"/>
         <h:selectOneMenu value="#{userView.searchCriteria}" styleClass="selectMenu">
            <f:selectItem itemValue="gender" itemLabel="Gender"/>
            <f:selectItem itemValue="username" itemLabel="Username"/>
            <f:selectItem itemValue="firstname" itemLabel="First Name"/>
            <f:selectItem itemValue="lastname" itemLabel="Last Name"/>
         </h:selectOneMenu>
         <h:commandButton value="Search" action="#{userView.searchDependants}" update=":userDetailsForm:dependantsTable" styleClass="button"/>

         <h:dataTable id="dependantsTable" value="#{userView.dependants}" var="dependant" rendered="#{not empty userView.dependants}" styleClass="dataTable">
            <h:column>
               <f:facet name="header">Username</f:facet>
               #{dependant.username}
            </h:column>
            <h:column>
               <f:facet name="header">First Name</f:facet>
               #{dependant.firstname}
            </h:column>
            <h:column>
               <f:facet name="header">Last Name</f:facet>
               #{dependant.lastname}
            </h:column>
            <h:column>
               <f:facet name="header">Date of Birth</f:facet>
               #{dependant.dateOfBirth}
            </h:column>
            <h:column>
               <h:commandButton value="Delete" action="#{dependantView.deleteDependant(dependant.id)}" update=":userDetailsForm:dependantsTable" styleClass="button"/>
            </h:column>
         </h:dataTable>
      </h:panelGrid>
   </h:form>

   <!-- Dialog for adding a new dependant -->
   <p:dialog header="Add Dependant" widgetVar="addDependantDialog" modal="true" resizable="false" appendTo="@(body)" styleClass="dialog">
      <h:form id="addDependantForm" styleClass="form">
         <h:panelGrid columns="2" styleClass="panelGrid">
            <h:outputLabel for="firstname" value="First Name:" styleClass="label"/>
            <h:inputText id="firstname" value="#{dependantView.dependant.firstname}" required="true" styleClass="input"/>

            <h:outputLabel for="lastname" value="Last Name:" styleClass="label"/>
            <h:inputText id="lastname" value="#{dependantView.dependant.lastname}" required="true" styleClass="input"/>

            <h:outputLabel for="username2" value="Username:" styleClass="label"/>
            <h:inputText id="username2" value="#{dependantView.dependant.username}" required="true" styleClass="input"/>

            <h:outputLabel for="gender" value="Gender:" styleClass="label"/>
            <h:selectOneMenu id="gender" value="#{dependantView.dependant.gender}" required="true" styleClass="selectMenu">
               <f:selectItem itemLabel="Male" itemValue="Male"/>
               <f:selectItem itemLabel="Female" itemValue="Female"/>
            </h:selectOneMenu>

            <h:outputLabel for="dateOfBirth" value="Date of Birth (dd/MM/yyyy):" styleClass="label"/>
            <p:calendar id="dateOfBirth" value="#{dependantView.dateOfBirth}" pattern="dd/MM/yyyy" required="true" styleClass="input"/>

            <f:facet name="footer">
               <p:commandButton value="Add" action="#{dependantView.addDependant}"
                                update=":userDetailsForm:userDetailsPanel :userDetailsForm:dependantsTable"
                                oncomplete="if (!args.validationFailed) PF('addDependantDialog').hide()" styleClass="button"/>
            </f:facet>
         </h:panelGrid>
      </h:form>
   </p:dialog>
</h:body>
</html>
