<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Display All Users</title>
    <h:outputStylesheet name="css/newui/dependants.css"/>
</h:head>

<h:body>
    <div class="container">
        <div class="sidebar">
            <ui:include src="sidebar.xhtml"/>
        </div>
        <div class="main-content">
            <div class="dependants-management">
                <h2 class="dependants-header">Dependants</h2>
                <div class="summary-cards">
                    <div class="card">
                        <h:outputText value="Female Dependants" /><br/>
                        <h:outputText value="#{userDashboardStats.femaleUserCount}" />
                    </div>
                    <div class="card">
                        <h:outputText value="Male Dependants" /><br/>
                        <h:outputText value="#{userDashboardStats.maleUserCount}" />
                    </div>
                    <div class="card">
                        <h:outputText value="Dependency ratio" /><br/>
                        <h:outputText value="#{userDashboardStats.maleFemaleRatio}" />
                    </div>
                </div>

                <h:form id="seachDependantsForm" styleClass="search-form">
                    <div class="search-bar">

                        <h:selectOneMenu value="#{userView.selectedGender}">
                            <f:selectItem itemLabel="Select Gender" itemValue="" />
                            <f:selectItem itemLabel="Male" itemValue="Male" />
                            <f:selectItem itemLabel="Female" itemValue="Female" />
                        </h:selectOneMenu>

                        <p:commandButton value="Apply Filter" action="#{userView.filterDependants}" update="dependantsForm" />

                    </div>
                </h:form>

                <div>
                    <!-- Search Form -->
                    <h:form id="search-form">
                        <div class="search-bar">
                            <h:outputLabel for="searchUsername" value="Username"/>
                            <h:inputText id="searchUsername" value="#{userView.searchDependantUsername}" />

                            <h:outputLabel for="searchFirstName" value="First Name"/>
                            <h:inputText id="searchFirstName" value="#{userView.searchDependantFirstName}" />

                            <h:outputLabel for="searchLastName" value="Last Name"/>
                            <h:inputText id="searchLastName" value="#{userView.searchDependantLastName}" />

                            <p:commandButton value="Search" action="#{userView.searchingDependants}" update="dependantsForm" />
                            <p:commandButton value="Reset" action="#{userView.resetDependants}" update="dependantsForm" />

                        </div>
                    </h:form>
                </div>


                <div>
                    <h:form id="displayForm" styleClass="top-section">

                        <h:commandLink value="Add Dependant" action="/pages/userpages/addDependantUser.xhtml" styleClass="link"/>
                        <p:commandLink value="Delete All Dependants" styleClass="link" action="#{deleteAllDependantsOfUser.selectUserId(userView.user.id)}" oncomplete="PF('deleteAllDependantsDialog').show()" process="@this"/>

                    </h:form>
                </div>

                <div class="dependants-table">
                    <h:form id="dependantsForm">
                        <p:dataTable id="dependants-table" value="#{userView.dependants}" var="dependant" paginator="true" rows="5" styleClass="data-table">
                            <p:column headerText="First Name">
                                <h:outputText value="#{dependant.firstname}"/>
                            </p:column>
                            <p:column headerText="Last Name">
                                <h:outputText value="#{dependant.lastname}"/>
                            </p:column>

                            <p:column headerText="Date of Birth">
                                <h:outputText value="#{dependant.dateOfBirth}">
                                    <f:convertDateTime pattern="yyyy-MM-dd" />
                                </h:outputText>
                            </p:column>

                            <p:column headerText="Gender">
                                <h:outputText value="#{dependant.gender}"/>
                            </p:column>
                            <p:column headerText="User">
                                <h:outputText value="#{dependant.user}"/>
                            </p:column>



                            <p:column headerText="Action">
                                <h:commandButton value="Edit" onclick="setUserCookie('#{userView.user.username}');" action="#{updateDependant.selectDependantUser(dependant.id)}" styleClass="action-link"/>


                                <p:commandLink value="Delete" styleClass="action-link" action="#{deleteDependantOfUser.selectedId(dependant.id)}" oncomplete="PF('deleteDialog').show()" process="@this">
                                    <f:setPropertyActionListener target="#{deleteDependantOfUser.dependant_id}" value="#{dependant.id}" />
                                </p:commandLink>
                            </p:column>

                        </p:dataTable>


                    </h:form>

                    <!-- Delete Confirmation Dialog -->
                    <p:dialog header="Confirm Deletion" widgetVar="deleteDialog" modal="true" width="300">
                        <h:form>
                            <h:panelGrid columns="2">
                                <h:outputText value="Are you sure you want to delete?" />
                                <br/>
                                <p:commandButton value="Yes" action="#{deleteDependantOfUser.deleteDependant}" oncomplete="PF('deleteDialog').hide(); updateDependantTable();" />
                                <p:commandButton value="Cancel" onclick="PF('deleteDialog').hide(); return false;" />
                            </h:panelGrid>
                        </h:form>
                    </p:dialog>

                    <!-- Delete All dependants Confirmation Dialog -->
                    <p:dialog header="Confirm Deletion" widgetVar="deleteAllDependantsDialog" modal="true" width="300">
                        <h:form>
                            <h:panelGrid columns="2">
                                <h:outputText value="Delete All Dependants?" />
                                <br/>
                                <p:commandButton value="Yes" action="#{deleteAllDependantsOfUser.deleteAllDependants}" oncomplete="PF('deleteAllDependantsDialog').hide(); updateDependantTable();" />
                                <p:commandButton value="Cancel" onclick="PF('deleteAllDependantsDialog').hide(); return false;" />
                            </h:panelGrid>
                        </h:form>
                    </p:dialog>

                    <!-- Remote Command to update the user table -->
                    <p:remoteCommand name="updateDependantTable" update="dependantsForm" />



                </div>
            </div>

        </div>
    </div>
</h:body>
</html>
